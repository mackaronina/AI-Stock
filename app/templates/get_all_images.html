{% extends "base.html" %}
{% block content %}
    <div class="mb-4">
        <h2 class="text-white text-center mb-4">
            <i class="bi bi-grid"></i> Explore Images
        </h2>

        <div class="card mb-4">
            <div class="card-body">
                <form action="{{ url_for('get_all_images_page') }}" method="GET">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label for="term" class="form-label fw-semibold">Search</label>
                            <input
                                    type="search"
                                    class="form-control"
                                    id="term"
                                    name="term"
                                    placeholder="Search by text..."
                                    {% if search_query.term %}value="{{ search_query.term }}"{% endif %}
                            >
                        </div>
                        <div class="col-md-3">
                            <label for="sort_by" class="form-label fw-semibold">Sort by</label>
                            <select id="sort_by" name="sort_by" class="form-select">
                                {% if search_query.sort_by == 'likes' %}
                                    <option value="likes" selected>Likes</option>
                                    <option value="date">Creation date</option>
                                {% else %}
                                    <option value="likes">Likes</option>
                                    <option value="date" selected>Creation date</option>
                                {% endif %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="order_by" class="form-label fw-semibold">Order</label>
                            <select id="order_by" name="order_by" class="form-select">
                                {% if search_query.order_by == 'desc' %}
                                    <option value="desc" selected>Descending</option>
                                    <option value="asc">Ascending</option>
                                {% else %}
                                    <option value="desc">Descending</option>
                                    <option value="asc" selected>Ascending</option>
                                {% endif %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-search"></i> Search
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        {% for image in images if image.is_public %}
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="card h-100">
                    <a href="{{ url_for('get_image_page', image_id=image.id) }}" class="text-decoration-none">
                        <img src="{{ image.url }}" class="card-img-top" alt="AI Generated Image"
                             style="height: 300px; object-fit: cover;">
                    </a>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="bi bi-heart-fill text-danger"></i> {{ image.likes | length }}
                            </small>
                            <small class="text-muted">
                                <i class="bi bi-calendar"></i> {{ image.created_at.strftime('%d.%m.%Y') }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="bi bi-inbox display-1 text-muted"></i>
                        <h5 class="mt-3 text-muted">No images found</h5>
                        <p class="text-muted">Try adjusting your search filters</p>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    {% if total_pages > 1 %}
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                {% if search_query.page > 1 %}
                    <li class="page-item">
                        <a class="page-link"
                           href="{{ url_for('get_all_images_page').include_query_params(sort_by=search_query.sort_by, order_by=search_query.order_by, term=search_query.term, page=search_query.page - 1, page_size=search_query.page_size) }}">
                            Previous
                        </a>
                    </li>
                {% endif %}

                {% for p in range(1, total_pages + 1) %}
                    {% if p == search_query.page %}
                        <li class="page-item active">
                            <span class="page-link">{{ p }}</span>
                        </li>
                    {% else %}
                        <li class="page-item">
                            <a class="page-link"
                               href="{{ url_for('get_all_images_page').include_query_params(sort_by=search_query.sort_by, order_by=search_query.order_by, term=search_query.term, page=p, page_size=search_query.page_size) }}">
                                {{ p }}
                            </a>
                        </li>
                    {% endif %}
                {% endfor %}

                {% if search_query.page < total_pages %}
                    <li class="page-item">
                        <a class="page-link"
                           href="{{ url_for('get_all_images_page').include_query_params(sort_by=search_query.sort_by, order_by=search_query.order_by, term=search_query.term, page=search_query.page + 1, page_size=search_query.page_size) }}">
                            Next
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
{% endblock %}