{% extends "base.html" %}
{% block content %}
    <h1>Explore images</h1>
    <form action="{{ url_for('get_all_images_page') }}" method="GET">
        <label for="sort_by">Sort by</label>
        <select id="sort_by" name="sort_by">
            {% if search_query.sort_by == 'likes' %}
                <option value="likes" selected>Likes</option>
                <option value="date">Creation date</option>
            {% else %}
                <option value="likes">Likes</option>
                <option value="date" selected>Creation date</option>
            {% endif %}
        </select>
        <label for="order_by">Order by</label>
        <select id="order_by" name="order_by">
            {% if search_query.order_by == 'desc' %}
                <option value="desc" selected>Descending</option>
                <option value="asc">Ascending</option>
            {% else %}
                <option value="desc">Descending</option>
                <option value="asc" selected>Ascending</option>
            {% endif %}
        </select>
        {% if search_query.term %}
            <input type="search" id="term" name="term" value="{{ search_query.term }}"
                   placeholder="Enter your search term...">
        {% else %}
            <input type="search" id="term" name="term" placeholder="Enter your search term...">
        {% endif %}
        <input type="submit" value="Search">
    </form>
    {% for image in images if image.is_public %}
        <div>
            <a href="{{ url_for('get_image_page', image_id=image.id) }}">
                <img src="{{ image.url }}" height="256" width="192" alt="Loading...">
            </a>
            <p>Likes {{ image.likes | length }}</p>
            <p>Created at {{ image.created_at.strftime('%d.%m.%Y') }}</p>
        </div>
    {% else %}
        <p>Nothing found</p>
    {% endfor %}
    <div>
        {% if search_query.page > 1 %}
            <a href="{{ url_for('get_all_images_page').include_query_params(sort_by=search_query.sort_by,
            order_by=search_query.order_by,term=search_query.term, page=search_query.page - 1,
            page_size=search_query.page_size) }}">Prev</a>
        {% endif %}
        {% for p in range(1, total_pages + 1) %}
            {% if p == search_query.page %}
                <a>{{ p }}</a>
            {% else %}
                <a href="{{ url_for('get_all_images_page').include_query_params(sort_by=search_query.sort_by,
                order_by=search_query.order_by,term=search_query.term, page=p,
                page_size=search_query.page_size) }}">{{ p }}</a>
            {% endif %}
        {% endfor %}
        {% if search_query.page < total_pages %}
            <a href="{{ url_for('get_all_images_page').include_query_params(sort_by=search_query.sort_by,
            order_by=search_query.order_by,term=search_query.term, page=search_query.page + 1,
            page_size=search_query.page_size) }}">Next</a>
        {% endif %}
    </div>
{% endblock %}